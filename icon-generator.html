<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ñ–∫–æ–Ω–æ–∫ –¥–ª—è Chrome —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 16px;
            padding: 40px;
            max-width: 800px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #333;
            margin-bottom: 10px;
            font-size: 28px;
        }
        
        .subtitle {
            color: #666;
            margin-bottom: 30px;
            font-size: 14px;
        }
        
        .preview-section {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .preview-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            transition: all 0.3s;
        }
        
        .preview-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
        }
        
        .preview-card canvas {
            border: 1px solid #dee2e6;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .preview-card .size {
            font-size: 12px;
            color: #6c757d;
            margin-bottom: 10px;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-download-all {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            width: 100%;
            padding: 15px;
            font-size: 16px;
            margin-top: 20px;
        }
        
        .instructions {
            background: #e7f3ff;
            border-left: 4px solid #2196F3;
            padding: 20px;
            border-radius: 8px;
            margin-top: 30px;
        }
        
        .instructions h3 {
            color: #1976D2;
            margin-bottom: 10px;
            font-size: 16px;
        }
        
        .instructions ol {
            margin-left: 20px;
            color: #424242;
            line-height: 1.8;
        }
        
        .success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
            display: none;
        }
        
        .logo-svg {
            display: none;
        }
        
        .converter-section {
            margin-top: 40px;
            padding-top: 40px;
            border-top: 2px solid #e9ecef;
        }
        
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 12px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            background: #f8f9ff;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .upload-area:hover {
            background: #f0f2ff;
            border-color: #764ba2;
        }
        
        .upload-area.dragover {
            background: #e7eaff;
            border-color: #5a67d8;
        }
        
        .preview-container {
            display: flex;
            gap: 20px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        .preview-box {
            flex: 1;
            min-width: 300px;
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
        }
        
        .preview-box h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .preview-image {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 200px;
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
        }
        
        .preview-image img, .preview-image svg {
            max-width: 100%;
            max-height: 300px;
        }
        
        .options-group {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .options-group label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            font-weight: 500;
        }
        
        .options-group input[type="number"],
        .options-group input[type="range"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            margin-top: 5px;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .button-group .btn {
            flex: 1;
        }
        
        input[type="file"] {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üé® –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —ñ–∫–æ–Ω–æ–∫</h1>
        <p class="subtitle">Chrome Extension: Laravel & CodeIgniter Debugger</p>
        
        <div class="preview-section">
            <div class="preview-card">
                <canvas id="canvas16" width="16" height="16"></canvas>
                <div class="size">16√ó16 px</div>
                <button class="btn" onclick="downloadIcon(16)">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
            </div>
            
            <div class="preview-card">
                <canvas id="canvas32" width="32" height="32"></canvas>
                <div class="size">32√ó32 px</div>
                <button class="btn" onclick="downloadIcon(32)">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
            </div>
            
            <div class="preview-card">
                <canvas id="canvas48" width="48" height="48"></canvas>
                <div class="size">48√ó48 px</div>
                <button class="btn" onclick="downloadIcon(48)">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
            </div>
            
            <div class="preview-card">
                <canvas id="canvas128" width="128" height="128"></canvas>
                <div class="size">128√ó128 px</div>
                <button class="btn" onclick="downloadIcon(128)">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏</button>
            </div>
        </div>
        
        <button class="btn btn-download-all" onclick="downloadAll()">
            üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—Å—ñ —ñ–∫–æ–Ω–∫–∏ (ZIP)
        </button>
        
        <div class="success" id="success">
            ‚úÖ –Ü–∫–æ–Ω–∫–∏ —É—Å–ø—ñ—à–Ω–æ –∑–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω—ñ! –ó–±–µ—Ä–µ–∂—ñ—Ç—å —ó—Ö –≤ –ø–∞–ø–∫—É icons/
        </div>
        
        <div class="instructions">
            <h3>üìã –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è:</h3>
            <ol>
                <li>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏" –ø—ñ–¥ –∫–æ–∂–Ω–æ—é —ñ–∫–æ–Ω–∫–æ—é</li>
                <li>–ó–±–µ—Ä–µ–∂—ñ—Ç—å —Ñ–∞–π–ª–∏ —è–∫: <code>icon16.png</code>, <code>icon32.png</code>, <code>icon48.png</code>, <code>icon128.png</code></li>
                <li>–ü–æ–º—ñ—Å—Ç—ñ—Ç—å —ó—Ö —É –ø–∞–ø–∫—É <code>icons/</code> –≤–∞—à–æ–≥–æ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è</li>
                <li>–ì–æ—Ç–æ–≤–æ! –¢–µ–ø–µ—Ä –º–æ–∂–Ω–∞ –≤—Å—Ç–∞–Ω–æ–≤–ª—é–≤–∞—Ç–∏ —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –≤ Chrome</li>
            </ol>
        </div>

        <!-- –°–µ–∫—Ü—ñ—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó PNG –≤ SVG -->
        <div class="converter-section">
            <h1>üîÑ –ö–æ–Ω–≤–µ—Ä—Ç–µ—Ä PNG ‚Üí SVG</h1>
            <p class="subtitle">–ü–µ—Ä–µ—Ç–≤–æ—Ä—ñ—Ç—å —Ä–∞—Å—Ç—Ä–æ–≤–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è —É –≤–µ–∫—Ç–æ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç</p>

            <div class="upload-area" id="uploadArea">
                <div style="font-size: 48px; margin-bottom: 10px;">üìÅ</div>
                <p style="font-size: 16px; color: #333; margin-bottom: 5px;">
                    –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å PNG —Ñ–∞–π–ª —Å—é–¥–∏ –∞–±–æ –∫–ª–∞—Ü–Ω—ñ—Ç—å –¥–ª—è –≤–∏–±–æ—Ä—É
                </p>
                <p style="font-size: 12px; color: #666;">
                    –ü—ñ–¥—Ç—Ä–∏–º—É—é—Ç—å—Å—è —Ñ–æ—Ä–º–∞—Ç–∏: PNG, JPG, JPEG
                </p>
                <input type="file" id="fileInput" accept="image/png,image/jpeg,image/jpg">
            </div>

            <div id="previewSection" style="display: none;">
                <div class="preview-container">
                    <div class="preview-box">
                        <h3>–û—Ä–∏–≥—ñ–Ω–∞–ª (PNG)</h3>
                        <div class="preview-image" id="pngPreview"></div>
                    </div>
                    <div class="preview-box">
                        <h3>–†–µ–∑—É–ª—å—Ç–∞—Ç (SVG)</h3>
                        <div class="preview-image" id="svgPreview"></div>
                    </div>
                </div>

                <div class="options-group">
                    <label>
                        –†–µ–∂–∏–º –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó:
                        <select id="conversionMode" style="width: 100%; padding: 8px; border: 1px solid #dee2e6; border-radius: 6px; margin-top: 5px;">
                            <option value="embed">–í–±—É–¥–æ–≤—É–≤–∞–Ω–Ω—è (PNG –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ SVG)</option>
                            <option value="trace">–í–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è (—Ç—Ä–µ–π—Å—ñ–Ω–≥)</option>
                        </select>
                    </label>

                    <div id="traceOptions" style="display: none; margin-top: 15px;">
                        <label>
                            –ü–æ—Ä—ñ–≥ (Threshold): <span id="thresholdValue">128</span>
                            <input type="range" id="threshold" min="0" max="255" value="128">
                        </label>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn" onclick="convertToSVG()">üîÑ –ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏</button>
                    <button class="btn" onclick="downloadSVG()" id="downloadSvgBtn" disabled>üíæ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ SVG</button>
                    <button class="btn" onclick="resetConverter()">üîÑ –°–∫–∏–Ω—É—Ç–∏</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // SVG –ª–æ–≥–æ (–∑–∞–≤–∞–Ω—Ç–∞–∂—É—î—Ç—å—Å—è –∑ logo.svg)
        let svgString = null;

        // –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è SVG –∑ —Ñ–∞–π–ª—É
        async function loadSVG() {
            try {
                const response = await fetch('logo.svg');
                if (!response.ok) {
                    throw new Error('–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ logo.svg');
                }
                svgString = await response.text();
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è SVG:', error);
                // –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î–º–æ –∑–∞–ø–∞—Å–Ω–∏–π –≤–∞—Ä—ñ–∞–Ω—Ç
                svgString = `
                    <svg width="128" height="128" viewBox="0 0 128 128" xmlns="http://www.w3.org/2000/svg">
                        <rect width="128" height="128" rx="24" fill="#667eea"/>
                        <text x="64" y="90" font-family="Arial, sans-serif" font-size="72" 
                              font-weight="bold" text-anchor="middle" fill="white">?</text>
                    </svg>
                `;
            }
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥—É SVG –Ω–∞ canvas
        function renderIcon(size) {
            if (!svgString) {
                console.error('SVG —â–µ –Ω–µ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–æ');
                return;
            }

            const canvas = document.getElementById(`canvas${size}`);
            const ctx = canvas.getContext('2d');
            
            const img = new Image();
            const svg = new Blob([svgString], {type: 'image/svg+xml'});
            const url = URL.createObjectURL(svg);
            
            img.onload = function() {
                ctx.drawImage(img, 0, 0, size, size);
                URL.revokeObjectURL(url);
            };
            
            img.src = url;
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —ñ–∫–æ–Ω–∫–∏
        function downloadIcon(size) {
            const canvas = document.getElementById(`canvas${size}`);
            const link = document.createElement('a');
            link.download = `icon${size}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
            
            document.getElementById('success').style.display = 'block';
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –≤—Å—ñ—Ö —ñ–∫–æ–Ω–æ–∫ –≤ ZIP
        async function downloadAll() {
            const sizes = [16, 32, 48, 128];
            const zip = new JSZip();
            
            // –î–æ–¥–∞—î–º–æ –∫–æ–∂–Ω—É —ñ–∫–æ–Ω–∫—É –¥–æ ZIP
            sizes.forEach(size => {
                const canvas = document.getElementById(`canvas${size}`);
                const dataURL = canvas.toDataURL('image/png');
                // –í–∏–¥–∞–ª—è—î–º–æ –ø—Ä–µ—Ñ—ñ–∫—Å data:image/png;base64,
                const base64Data = dataURL.split(',')[1];
                zip.file(`icon${size}.png`, base64Data, {base64: true});
            });
            
            // –ì–µ–Ω–µ—Ä—É—î–º–æ ZIP —Ñ–∞–π–ª
            try {
                const content = await zip.generateAsync({type: 'blob'});
                
                // –ó–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ ZIP
                const link = document.createElement('a');
                link.href = URL.createObjectURL(content);
                link.download = 'icons.zip';
                link.click();
                
                // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—Ö
                const successMsg = document.getElementById('success');
                successMsg.innerHTML = '‚úÖ –í—Å—ñ —ñ–∫–æ–Ω–∫–∏ —É–ø–∞–∫–æ–≤–∞–Ω—ñ –≤ ZIP –∞—Ä—Ö—ñ–≤!';
                successMsg.style.display = 'block';
                
                setTimeout(() => {
                    successMsg.style.display = 'none';
                }, 3000);
            } catch (error) {
                console.error('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è ZIP:', error);
                alert('–ü–æ–º–∏–ª–∫–∞ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è ZIP –∞—Ä—Ö—ñ–≤—É');
            }
        }

        // –†–µ–Ω–¥–µ—Ä–∏–º–æ –≤—Å—ñ —ñ–∫–æ–Ω–∫–∏ –ø—Ä–∏ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏
        window.onload = async function() {
            // –°–ø–æ—á–∞—Ç–∫—É –∑–∞–≤–∞–Ω—Ç–∞–∂—É—î–º–æ SVG
            await loadSVG();
            // –ü–æ—Ç—ñ–º —Ä–µ–Ω–¥–µ—Ä–∏–º–æ —ñ–∫–æ–Ω–∫–∏
            [16, 32, 48, 128].forEach(size => renderIcon(size));
        };

        // === PNG to SVG Converter ===
        let uploadedImage = null;
        let convertedSVG = null;

        // –û–±—Ä–æ–±–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–∞–π–ª—É
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const previewSection = document.getElementById('previewSection');
        const conversionMode = document.getElementById('conversionMode');
        const traceOptions = document.getElementById('traceOptions');
        const threshold = document.getElementById('threshold');
        const thresholdValue = document.getElementById('thresholdValue');

        uploadArea.addEventListener('click', () => fileInput.click());

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file && file.type.startsWith('image/')) {
                handleFile(file);
            }
        });

        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        });

        conversionMode.addEventListener('change', () => {
            if (conversionMode.value === 'trace') {
                traceOptions.style.display = 'block';
            } else {
                traceOptions.style.display = 'none';
            }
        });

        threshold.addEventListener('input', () => {
            thresholdValue.textContent = threshold.value;
        });

        function handleFile(file) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    uploadedImage = img;
                    displayPNGPreview(img);
                    previewSection.style.display = 'block';
                    document.getElementById('downloadSvgBtn').disabled = true;
                    document.getElementById('svgPreview').innerHTML = '<p style="color: #999;">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–ö–æ–Ω–≤–µ—Ä—Ç—É–≤–∞—Ç–∏"</p>';
                };
                img.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        function displayPNGPreview(img) {
            const pngPreview = document.getElementById('pngPreview');
            pngPreview.innerHTML = '';
            const imgClone = img.cloneNode();
            imgClone.style.maxWidth = '100%';
            imgClone.style.maxHeight = '300px';
            pngPreview.appendChild(imgClone);
        }

        function convertToSVG() {
            if (!uploadedImage) return;

            const mode = conversionMode.value;
            
            if (mode === 'embed') {
                convertEmbed();
            } else {
                convertTrace();
            }
        }

        function convertEmbed() {
            const canvas = document.createElement('canvas');
            canvas.width = uploadedImage.width;
            canvas.height = uploadedImage.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(uploadedImage, 0, 0);
            
            const dataURL = canvas.toDataURL('image/png');
            
            convertedSVG = `<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="${uploadedImage.width}" height="${uploadedImage.height}" viewBox="0 0 ${uploadedImage.width} ${uploadedImage.height}">
    <image width="${uploadedImage.width}" height="${uploadedImage.height}" xlink:href="${dataURL}"/>
</svg>`;

            // –û–Ω–æ–≤–ª—é—î–º–æ svgString —Ç–∞ —ñ–∫–æ–Ω–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
            svgString = convertedSVG;
            updateIconsFromNewSVG();

            displaySVGPreview(convertedSVG);
        }

        function convertTrace() {
            const canvas = document.createElement('canvas');
            canvas.width = uploadedImage.width;
            canvas.height = uploadedImage.height;
            const ctx = canvas.getContext('2d');
            ctx.drawImage(uploadedImage, 0, 0);
            
            const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
            const thresholdVal = parseInt(threshold.value);
            
            // –ü—Ä–æ—Å—Ç–∞ –≤–µ–∫—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è —á–µ—Ä–µ–∑ –ø–æ—Ä—ñ–≥
            const paths = traceBitmap(imageData, thresholdVal);
            
            convertedSVG = `<svg xmlns="http://www.w3.org/2000/svg" width="${canvas.width}" height="${canvas.height}" viewBox="0 0 ${canvas.width} ${canvas.height}">
    ${paths}
</svg>`;

            // –û–Ω–æ–≤–ª—é—î–º–æ svgString —Ç–∞ —ñ–∫–æ–Ω–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
            svgString = convertedSVG;
            updateIconsFromNewSVG();

            displaySVGPreview(convertedSVG);
        }

        // –§—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ–Ω–æ–≤–ª–µ–Ω–Ω—è —ñ–∫–æ–Ω–æ–∫ –ø—ñ—Å–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∞—Ü—ñ—ó
        function updateIconsFromNewSVG() {
            [16, 32, 48, 128].forEach(size => renderIcon(size));
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ —É—Å–ø—ñ—à–Ω–µ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è
            const successMsg = document.getElementById('success');
            successMsg.innerHTML = '‚úÖ –Ü–∫–æ–Ω–∫–∏ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –æ–Ω–æ–≤–ª–µ–Ω–æ –∑ –Ω–æ–≤–æ–≥–æ SVG!';
            successMsg.style.display = 'block';
            
            // –°—Ö–æ–≤–∞—î–º–æ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —á–µ—Ä–µ–∑ 3 —Å–µ–∫—É–Ω–¥–∏
            setTimeout(() => {
                successMsg.style.display = 'none';
            }, 3000);
        }

        function traceBitmap(imageData, threshold) {
            const width = imageData.width;
            const height = imageData.height;
            const data = imageData.data;
            
            // –°—Ç–≤–æ—Ä—é—î–º–æ –º–∞—Å–∏–≤ –ø—Ä—è–º–æ–∫—É—Ç–Ω–∏–∫—ñ–≤ –¥–ª—è –∫–æ–∂–Ω–æ–≥–æ —Ç–µ–º–Ω–æ–≥–æ –ø—ñ–∫—Å–µ–ª—è
            let rects = [];
            
            for (let y = 0; y < height; y++) {
                for (let x = 0; x < width; x++) {
                    const i = (y * width + x) * 4;
                    const r = data[i];
                    const g = data[i + 1];
                    const b = data[i + 2];
                    const a = data[i + 3];
                    
                    // –û–±—á–∏—Å–ª—é—î–º–æ —è—Å–∫—Ä–∞–≤—ñ—Å—Ç—å
                    const brightness = (r + g + b) / 3;
                    
                    // –Ø–∫—â–æ –ø—ñ–∫—Å–µ–ª—å —Ç–µ–º–Ω–∏–π —ñ –Ω–µ–ø—Ä–æ–∑–æ—Ä–∏–π
                    if (brightness < threshold && a > 128) {
                        const color = `rgb(${r},${g},${b})`;
                        rects.push(`<rect x="${x}" y="${y}" width="1" height="1" fill="${color}" opacity="${a/255}"/>`);
                    }
                }
            }
            
            return rects.join('\n    ');
        }

        function displaySVGPreview(svgString) {
            const svgPreview = document.getElementById('svgPreview');
            svgPreview.innerHTML = svgString;
            document.getElementById('downloadSvgBtn').disabled = false;
        }

        function downloadSVG() {
            if (!convertedSVG) return;

            const blob = new Blob([convertedSVG], { type: 'image/svg+xml' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'converted.svg';
            link.click();
            URL.revokeObjectURL(url);
        }

        function resetConverter() {
            uploadedImage = null;
            convertedSVG = null;
            previewSection.style.display = 'none';
            fileInput.value = '';
            document.getElementById('pngPreview').innerHTML = '';
            document.getElementById('svgPreview').innerHTML = '';
            document.getElementById('downloadSvgBtn').disabled = true;
        }
    </script>
</body>
</html>
